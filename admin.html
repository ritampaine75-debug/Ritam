<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Admin Master</title>
    <!-- FontAwesome & Google Fonts -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #6C63FF;
            --primary-grad: linear-gradient(135deg, #8A2BE2 0%, #4B0082 100%);
            --secondary-grad: linear-gradient(135deg, #FF6B6B 0%, #EE5D5D 100%);
            --bg: #F4F7FC;
            --card-bg: #FFFFFF;
            --sidebar-bg: #1A1A2E;
            --text-main: #2D3436;
            --text-sec: #636E72;
            --border: #EFEFEF;
            --shadow: 0 10px 30px rgba(0,0,0,0.05);
            --shadow-hover: 0 15px 35px rgba(138, 43, 226, 0.15);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; outline: none; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text-main); overflow-x: hidden; font-size: 14px; }

        /* BUTTONS */
        .btn { padding: 12px 20px; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); display: inline-block; width: 100%; text-align: center; letter-spacing: 0.5px; font-size: 0.9rem; position: relative; overflow: hidden; }
        
        .btn-primary { background: var(--primary-grad); color: white; box-shadow: 0 4px 15px rgba(138, 43, 226, 0.3); }
        .btn-primary:active { transform: scale(0.97); }
        
        .btn-danger { background: var(--secondary-grad); color: white; width: auto; padding: 8px 16px; border-radius: 8px; font-size: 0.8rem; box-shadow: 0 4px 10px rgba(238, 93, 93, 0.3); }
        
        .btn-outline { background: transparent; border: 2px solid #E0E0E0; color: var(--text-sec); font-weight: 600; }
        .btn-outline:hover { border-color: var(--primary); color: var(--primary); background: rgba(108, 99, 255, 0.05); }

        /* INPUTS */
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; color: var(--text-sec); font-size: 0.85rem; margin-bottom: 8px; font-weight: 500; }
        input, select, textarea { width: 100%; padding: 14px 16px; background: #FAFBFF; border: 2px solid #EFF0F6; color: var(--text-main); border-radius: 12px; font-size: 0.95rem; transition: 0.3s; }
        input:focus, select:focus, textarea:focus { border-color: var(--primary); background: #fff; box-shadow: 0 0 0 4px rgba(108, 99, 255, 0.1); }

        /* CARDS */
        .card { background: var(--card-bg); padding: 20px; border-radius: 20px; margin-bottom: 20px; box-shadow: var(--shadow); border: 1px solid white; transition: 0.3s; position: relative; overflow: hidden; }
        .flex-row { display: flex; justify-content: space-between; align-items: center; }

        /* LOADING */
        #loader { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .spinner { border: 4px solid rgba(138, 43, 226, 0.1); border-top: 4px solid #8A2BE2; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* AUTH SCREEN */
        #auth-screen { position: fixed; inset: 0; background: #fff; z-index: 2000; display: flex; flex-direction: column; justify-content: center; padding: 40px; }
        .auth-card { max-width: 400px; width: 100%; margin: 0 auto; text-align: center; }
        .auth-logo { width: 80px; height: 80px; border-radius: 20px; background: var(--primary-grad); margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; color: white; font-size: 30px; box-shadow: 0 10px 20px rgba(138, 43, 226, 0.3); }

        /* APP STRUCTURE */
        #app-container { display: none; padding-top: 70px; min-height: 100vh; padding-bottom: 40px; }
        
        /* HEADER */
        header { position: fixed; top: 0; left: 0; width: 100%; height: 70px; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); z-index: 1000; display: flex; align-items: center; padding: 0 20px; justify-content: space-between; border-bottom: 1px solid rgba(0,0,0,0.05); box-shadow: 0 5px 20px rgba(0,0,0,0.02); }
        .menu-btn { font-size: 1.4rem; color: var(--text-main); cursor: pointer; background: #F5F6FA; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 10px; }
        .header-title { font-weight: 700; font-size: 1.2rem; color: var(--text-main); }

        /* SIDE MENU */
        #side-menu { position: fixed; top: 0; left: 0; width: 280px; height: 100%; background: var(--sidebar-bg); z-index: 1500; transform: translateX(-100%); transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); display: flex; flex-direction: column; box-shadow: 5px 0 20px rgba(0,0,0,0.1); border-radius: 0 25px 25px 0; overflow: hidden; }
        #side-menu.active { transform: translateX(0); }
        
        .menu-header { padding: 40px 25px 20px; background: linear-gradient(135deg, #8A2BE2 0%, #6C63FF 100%); color: white; font-size: 1.5rem; font-weight: 800; display: flex; flex-direction: column; justify-content: flex-end; height: 160px; }
        .menu-content { overflow-y: auto; padding: 15px; flex: 1; }
        .menu-item { padding: 14px 18px; margin-bottom: 8px; border-radius: 12px; cursor: pointer; color: rgba(255,255,255,0.7); display: flex; align-items: center; gap: 15px; transition: 0.2s; font-weight: 500; font-size: 0.95rem; }
        .menu-item:hover { background: rgba(255,255,255,0.05); color: white; }
        .menu-item.active-link { background: #6C63FF; color: white; box-shadow: 0 5px 15px rgba(108, 99, 255, 0.4); }
        
        .menu-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.2); backdrop-filter: blur(3px); z-index: 1400; opacity: 0; pointer-events: none; transition: 0.3s; }
        .menu-overlay.active { opacity: 1; pointer-events: auto; }

        /* SECTIONS */
        .section { display: none; padding: 20px; animation: slideUp 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); }
        .section.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* DASHBOARD STATS */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .stat-card { background: white; padding: 20px; border-radius: 18px; text-align: center; border: 1px solid #f0f0f0; box-shadow: var(--shadow); position: relative; overflow: hidden; }
        .stat-card::before { content:''; position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: var(--primary-grad); }
        .stat-val { font-size: 1.8rem; font-weight: 800; color: #2D3436; margin-top: 8px; }
        .stat-label { font-size: 0.85rem; color: #888; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }

        /* MODALS */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); z-index: 3000; display: none; align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: white; width: 100%; max-width: 500px; border-radius: 24px; padding: 30px; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 50px rgba(0,0,0,0.2); transform: translateY(20px); animation: modalIn 0.3s forwards; }
        @keyframes modalIn { to { transform: translateY(0); } }
        
        .list-item-img { width: 50px; height: 50px; border-radius: 12px; object-fit: cover; margin-right: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .badge { font-size: 0.7rem; background: rgba(108, 99, 255, 0.1); color: var(--primary); padding: 4px 10px; border-radius: 6px; font-weight: 700; margin-top: 5px; display: inline-block; }

        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #2D3436; color: white; padding: 12px 24px; border-radius: 50px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); z-index: 5000; display: none; font-weight: 500; font-size: 0.9rem; align-items: center; gap: 10px; }

    </style>
</head>
<body>

    <div id="loader"><div class="spinner"></div></div>
    <div id="toast" class="toast"></div>

    <!-- AUTH -->
    <div id="auth-screen">
        <div class="auth-card">
            <div class="auth-logo"><i class="fas fa-cube"></i></div>
            <h2 style="font-weight: 800; color: #2D3436; margin-bottom: 5px; font-size: 1.8rem;">Admin Portal</h2>
            <p style="color: #888; margin-bottom: 30px;">Manage your content efficiently</p>
            <div class="input-group" style="text-align: left;">
                <label>Email Address</label>
                <input id="l-email" type="email" placeholder="admin@master.com">
            </div>
            <div class="input-group" style="text-align: left;">
                <label>Password</label>
                <input id="l-pass" type="password" placeholder="••••••••">
            </div>
            <button class="btn btn-primary" onclick="handleLogin()">Sign In Dashboard</button>
        </div>
    </div>

    <!-- APP CONTAINER -->
    <div id="app-container">
        
        <header>
            <div class="menu-btn" onclick="toggleMenu()"><i class="fas fa-bars"></i></div>
            <img id="header-logo-admin" style="width:30px; height:30px; border-radius:8px; display:none; object-fit:cover; margin-right:10px;">
            <div style="flex:1;"><span class="header-title" id="page-title">Dashboard</span></div>
        </header>

        <div class="menu-overlay" onclick="toggleMenu()"></div>
        <div id="side-menu">
            <div class="menu-header">
                <i class="fas fa-layer-group" style="margin-bottom:10px; font-size: 2rem; opacity: 0.8;"></i>
                <span id="admin-brand-name">App Master</span>
            </div>
            <div class="menu-content">
                <div class="menu-item active-link" onclick="nav('dashboard')"><i class="fas fa-home"></i> Dashboard</div>
                <div class="menu-item" onclick="nav('app-controls')"><i class="fas fa-mobile-alt"></i> App Control</div>
                <div class="menu-item" onclick="nav('courses')"><i class="fas fa-book"></i> Courses</div>
                <div class="menu-item" onclick="nav('categories')"><i class="fas fa-tags"></i> Categories</div>
                <div class="menu-item" onclick="nav('slider')"><i class="fas fa-images"></i> Banners</div>
                <div class="menu-item" onclick="nav('live')"><i class="fas fa-video"></i> Live Stream</div>
                <div class="menu-item" onclick="nav('payments')"><i class="fas fa-wallet"></i> Payments</div>
                <div class="menu-item" onclick="nav('notifications')"><i class="fas fa-bell"></i> Push Notify</div>
                <div class="menu-item" onclick="nav('settings')"><i class="fas fa-credit-card"></i> Pay Settings</div>
                <div style="height: 20px;"></div>
                <div class="menu-item" onclick="logout()" style="color:#ff6b6b"><i class="fas fa-sign-out-alt"></i> Logout</div>
            </div>
        </div>

        <!-- 1. DASHBOARD -->
        <div id="sec-dashboard" class="section active">
            <h2 style="margin-bottom:20px; color:#2d3436;">Overview</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total Users</div>
                    <div class="stat-val" id="st-users">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Active Courses</div>
                    <div class="stat-val" id="st-courses">0</div>
                </div>
                <div class="stat-card" style="grid-column:span 2; background: linear-gradient(135deg, #6C63FF, #8A2BE2); color:white; border:none;">
                    <div class="stat-label" style="color:rgba(255,255,255,0.7);">Total Revenue</div>
                    <div class="stat-val" style="color:white;" id="st-rev">$0</div>
                </div>
            </div>
        </div>

        <!-- APP CONTROLS -->
        <div id="sec-app-controls" class="section">
            <div class="card">
                <h3><i class="fas fa-palette"></i> Branding</h3><br>
                <div class="input-group"><label>App Name</label><input id="app-name"></div>
                <div class="input-group"><label>Logo URL</label><input id="app-logo"></div>
                <div class="input-group"><label>Support Link</label><input id="app-support"></div>
                <div class="input-group"><label>Privacy Policy</label><textarea id="app-policy" rows="5"></textarea></div>
                <button class="btn btn-primary" onclick="saveAppSets()">Save Configuration</button>
            </div>
        </div>

        <!-- NOTIFICATIONS -->
        <div id="sec-notifications" class="section">
            <div class="card">
                <h3><i class="fas fa-paper-plane"></i> Send Alert</h3><br>
                <div class="input-group">
                    <label>Target Audience</label>
                    <select id="n-to" onchange="toggleNEmail()"><option value="ALL">All Users</option><option value="SINGLE">Single User</option></select>
                </div>
                <div class="input-group" id="n-email-div" style="display:none">
                    <label>User Email</label><input id="n-email">
                </div>
                <div class="input-group"><label>Message Content</label><textarea id="n-msg" rows="3"></textarea></div>
                <div class="input-group"><label>Action Link (Optional)</label><input id="n-link"></div>
                <button class="btn btn-primary" onclick="sendNotify()">Send Notification</button>
            </div>
        </div>

        <!-- COURSES -->
        <div id="sec-courses" class="section">
            <div class="flex-row" style="margin-bottom:15px;">
                <h3>Courses</h3>
                <button class="btn btn-primary" style="width:auto; padding: 10px 20px;" onclick="openModal('modal-course')"><i class="fas fa-plus"></i> Add</button>
            </div>
            <div id="list-courses"></div>
        </div>

        <!-- CATEGORIES -->
        <div id="sec-categories" class="section">
            <div class="card">
                <h3>New Category</h3>
                <div class="input-group" style="margin-top:10px;">
                    <input id="cat-name" placeholder="Category Name">
                </div>
                <button class="btn btn-primary" onclick="saveCat()">Create Category</button>
            </div>
            <h4 style="margin:20px 0 10px;">Existing Categories</h4>
            <div id="list-cats"></div>
        </div>

        <!-- LIVE -->
        <div id="sec-live" class="section">
            <div class="card">
                <h3><i class="fas fa-broadcast-tower"></i> Live Session Control</h3><br>
                <div class="input-group"><label>Session Title</label><input id="l-desc"></div>
                <div class="input-group"><label>Meeting Link</label><input id="l-link"></div>
                <div class="input-group"><label>Price ($0 for Free)</label><input type="number" id="l-price" value="0"></div>
                <div class="input-group"><label>Session Status</label><select id="l-stat"><option value="OFF">Ended / Offline</option><option value="ON">LIVE NOW</option></select></div>
                <button class="btn btn-primary" onclick="saveLive()">Update Status</button>
            </div>
        </div>

        <!-- SLIDER -->
        <div id="sec-slider" class="section">
            <button class="btn btn-primary" onclick="openModal('modal-promo')">+ Add Banner Slide</button>
            <div id="list-promo" style="margin-top:20px"></div>
        </div>

        <!-- PAYMENTS -->
        <div id="sec-payments" class="section">
            <div id="list-payments"></div>
        </div>

        <!-- SETTINGS -->
        <div id="sec-settings" class="section">
            <div class="card">
                <h3>Payment Methods</h3><br>
                <div class="input-group"><label>UPI ID (e.g. name@bank)</label><input id="set-upi"></div>
                <div class="input-group"><label>QR Code Image URL</label><input id="set-qr"></div>
                <button class="btn btn-primary" onclick="saveSets()">Save Payment Info</button>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div id="modal-course" class="modal">
        <div class="modal-content">
            <h3>Course Details</h3><br>
            <div class="input-group"><label>Title</label><input id="c-title"></div>
            <div class="input-group"><label>Category</label><select id="c-cat"></select></div>
            <div class="input-group"><label>Price ($)</label><input id="c-price" type="number"></div>
            <div class="input-group"><label>Description</label><textarea id="c-desc" rows="2"></textarea></div>
            <div class="input-group"><label>Cover Image URL</label><input id="c-img"></div>
            <div class="input-group"><label>Video Link (YouTube)</label><input id="c-vid"></div>
            <div class="input-group"><label>Notes Link (PDF/Drive)</label><input id="c-note"></div>
            <div class="flex-row" style="gap:10px; margin-top:20px;">
                <button class="btn btn-primary" onclick="saveCourse()">Save Course</button>
                <button class="btn btn-outline" onclick="closeModal('modal-course')">Close</button>
            </div>
        </div>
    </div>

    <div id="modal-promo" class="modal">
        <div class="modal-content">
            <h3>New Banner</h3><br>
            <div class="input-group"><label>Image URL</label><input id="p-img"></div>
            <div class="input-group"><label>Tap Link (Optional)</label><input id="p-link"></div>
            <div class="flex-row" style="gap:10px; margin-top:20px;">
                <button class="btn btn-primary" onclick="savePromo()">Add Banner</button>
                <button class="btn btn-outline" onclick="closeModal('modal-promo')">Close</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

    <script>
        // YOUR FIREBASE CONFIGURATION
        const firebaseConfig = {
            apiKey: "AIzaSyDUHXK7NYeM6CLNN4fsyGVz1MpIVpJuOq0",
            authDomain: "studio-vddd5.firebaseapp.com",
            databaseURL: "https://studio-vddd5-default-rtdb.firebaseio.com",
            projectId: "studio-vddd5",
            storageBucket: "studio-vddd5.firebasestorage.app",
            messagingSenderId: "679230106233",
            appId: "1:679230106233:web:3d6a91cabc2264e15902a8"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
        let allCats = {};

        auth.onAuthStateChanged(user => {
            document.getElementById('loader').style.display='none';
            if(user) {
                document.getElementById('auth-screen').style.display='none';
                document.getElementById('app-container').style.display='block';
                init();
            } else {
                document.getElementById('auth-screen').style.display='flex';
                document.getElementById('app-container').style.display='none';
            }
        });

        function handleLogin() {
            document.getElementById('loader').style.display='flex';
            auth.signInWithEmailAndPassword(document.getElementById('l-email').value, document.getElementById('l-pass').value)
                .catch(err => { document.getElementById('loader').style.display='none'; showToast(err.message); });
        }
        function logout(){ auth.signOut(); }

        function toggleMenu(){ 
            document.getElementById('side-menu').classList.toggle('active'); 
            document.querySelector('.menu-overlay').classList.toggle('active');
        }
        function nav(s){ 
            toggleMenu(); 
            document.querySelectorAll('.section').forEach(d=>d.classList.remove('active'));
            document.querySelector(`.menu-item[onclick="nav('${s}')"]`)?.classList.add('active-link');
            document.getElementById('sec-'+s).classList.add('active');
            const map = {'dashboard':'Dashboard', 'app-controls':'App Controls', 'notifications':'Notifications', 'courses':'Manage Courses', 'categories':'Categories', 'live':'Live Session', 'slider':'Banners', 'payments':'Payments', 'settings':'Pay Settings'};
            document.getElementById('page-title').innerText = map[s]||'Admin';
        }
        function openModal(id){ if(id==='modal-course') fillCatSelect(); document.getElementById(id).style.display='flex'; }
        function closeModal(id){ document.getElementById(id).style.display='none'; }
        function showToast(m){ const t = document.getElementById('toast'); t.innerText=m; t.style.display='flex'; setTimeout(()=>t.style.display='none',3000); }

        function init(){
            db.ref('users').on('value', s=>document.getElementById('st-users').innerText=s.numChildren());
            db.ref('courses').on('value', s=>document.getElementById('st-courses').innerText=s.numChildren());
            
            db.ref('payments').on('value', s => {
                let rev = 0; let pendingHTML = ''; const payList = document.getElementById('list-payments');
                s.forEach(doc => {
                    const p = doc.val();
                    if(p.status === 'APPROVED') { rev += parseFloat(p.amount || 0); } 
                    else if (p.status === 'PENDING') {
                        pendingHTML += `<div class="card">
                            <div class="flex-row"><div><b>${p.courseTitle}</b><br><small class="badge">$${p.amount}</small></div><small>${p.userEmail}</small></div>
                            <img src="${p.screenshot}" style="max-height:150px; border-radius:12px; margin:15px 0; border:1px solid #eee;">
                            <div class="flex-row"><button class="btn btn-primary" onclick="processPay('${doc.key}','${p.userId}','${p.courseId}',true)">Approve Access</button><div style="width:10px"></div><button class="btn btn-outline" style="color:red; border-color:red;" onclick="processPay('${doc.key}','${p.userId}','${p.courseId}',false)">Reject</button></div>
                        </div>`;
                    }
                });
                document.getElementById('st-rev').innerText = "$" + rev.toFixed(0);
                payList.innerHTML = pendingHTML || '<div class="card" style="text-align:center; color:#999; border:1px dashed #ddd; box-shadow:none;">No Pending Payments</div>';
            });
            loadData();
        }

        function loadData() {
            db.ref('categories').on('value', s=>{
                const d=document.getElementById('list-cats'); d.innerHTML=''; allCats={};
                s.forEach(c=>{
                    allCats[c.key]=c.val().name;
                    d.innerHTML+=`<div class="card flex-row" style="padding:15px;"><b>${c.val().name}</b><button class="btn-danger" style="width:auto" onclick="db.ref('categories/${c.key}').remove()">Delete</button></div>`;
                });
            });

            db.ref('courses').on('value', s=>{
                const d=document.getElementById('list-courses'); d.innerHTML='';
                s.forEach(c=>{
                    d.innerHTML+=`<div class="card flex-row">
                        <div style="display:flex;align-items:center;">
                            <img src="${c.val().bannerUrl}" class="list-item-img">
                            <div><b>${c.val().title}</b><br><small style="color:#888">$${c.val().price}</small></div>
                        </div>
                        <button class="btn-outline" style="width:auto; padding:5px 15px;" onclick="db.ref('courses/${c.key}').remove()">Delete</button>
                    </div>`;
                });
            });

            db.ref('promotions').on('value', s=>{
                const d=document.getElementById('list-promo'); d.innerHTML='';
                s.forEach(p=>{
                   d.innerHTML+=`<div class="card flex-row"><img src="${p.val().img}" height="60" style="border-radius:10px;"><button class="btn-danger" style="width:auto" onclick="db.ref('promotions/${p.key}').remove()">Remove</button></div>`; 
                });
            });

            db.ref('appSettings').on('value', s => {
                const v = s.val() || {};
                document.getElementById('app-name').value = v.appName || '';
                document.getElementById('app-logo').value = v.appLogo || '';
                document.getElementById('app-support').value = v.supportLink || '';
                document.getElementById('app-policy').value = v.policyText || '';
                if(v.appName) { document.getElementById('admin-brand-name').innerText = v.appName; }
                if(v.appLogo) { 
                    const l = document.getElementById('header-logo-admin'); 
                    l.src=v.appLogo; l.style.display='block';
                }
            });

            db.ref('liveSession').on('value',s=>{ if(s.exists()){ const v=s.val(); document.getElementById('l-desc').value=v.description; document.getElementById('l-link').value=v.link; document.getElementById('l-stat').value=v.status; document.getElementById('l-price').value=v.price||0; }});
            db.ref('adminSettings').on('value', s=>{ if(s.exists()){ document.getElementById('set-upi').value=s.val().upi; document.getElementById('set-qr').value=s.val().qr; }});
        }

        function fillCatSelect(){ const s=document.getElementById('c-cat'); s.innerHTML=''; Object.keys(allCats).forEach(k=>s.innerHTML+=`<option value="${k}">${allCats[k]}</option>`); }
        function saveCat(){ const n=document.getElementById('cat-name').value; if(n) db.ref('categories').push({name:n}).then(()=>{document.getElementById('cat-name').value=''; showToast('Category Added');}); }
        function saveCourse(){
            db.ref('courses').push({
                title: document.getElementById('c-title').value,
                categoryId: document.getElementById('c-cat').value,
                categoryName: allCats[document.getElementById('c-cat').value],
                description: document.getElementById('c-desc').value,
                price: document.getElementById('c-price').value,
                bannerUrl: document.getElementById('c-img').value,
                videoUrl: document.getElementById('c-vid').value,
                notesUrl: document.getElementById('c-note').value
            }).then(()=>{ closeModal('modal-course'); showToast('Course Published'); });
        }
        function savePromo(){ db.ref('promotions').push({ img:document.getElementById('p-img').value, link:document.getElementById('p-link').value }).then(()=>closeModal('modal-promo')); }
        function saveAppSets() {
            db.ref('appSettings').update({ appName:document.getElementById('app-name').value, appLogo:document.getElementById('app-logo').value, supportLink:document.getElementById('app-support').value, policyText:document.getElementById('app-policy').value }).then(() => showToast('Branding Saved'));
        }
        function saveSets(){ db.ref('adminSettings').update({ upi:document.getElementById('set-upi').value, qr:document.getElementById('set-qr').value }).then(()=>showToast('Payments Saved')); }
        function saveLive(){ db.ref('liveSession').update({ description:document.getElementById('l-desc').value, link:document.getElementById('l-link').value, price:document.getElementById('l-price').value, status:document.getElementById('l-stat').value }).then(()=>showToast('Live Updated')); }
        function processPay(pid, uid, cid, ok){
            const up = {}; up['payments/'+pid+'/status'] = ok?'APPROVED':'REJECTED';
            if(ok) up['users/'+uid+'/courses/'+cid] = true;
            db.ref().update(up).then(()=>showToast(ok?'Granted Access':'Payment Rejected'));
        }
        function toggleNEmail(){ document.getElementById('n-email-div').style.display = document.getElementById('n-to').value==='SINGLE' ? 'block':'none'; }
        function sendNotify(){
            const t=document.getElementById('n-to').value;
            db.ref('notifications').push({ targetType:t, targetEmail:document.getElementById('n-email').value, message:document.getElementById('n-msg').value, link:document.getElementById('n-link').value, timestamp:Date.now() }).then(()=>showToast('Sent!'));
        }
    </script>
</body>
</html>

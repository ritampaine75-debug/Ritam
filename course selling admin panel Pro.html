<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Learning App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root { 
            --primary: #6C63FF; 
            --primary-grad: linear-gradient(135deg, #8A2BE2 0%, #6C63FF 100%);
            --bg: #F4F6F9;
            --text-dark: #2D3436;
            --text-light: #B2BEC3;
            --white: #FFFFFF;
            --card-shadow: 0 10px 40px -10px rgba(0,0,0,0.05);
        }

        * { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins', sans-serif; -webkit-tap-highlight-color:transparent; }
        body { background: var(--bg); color: var(--text-dark); padding-bottom: 90px; }

        /* BUTTONS */
        .btn { padding: 14px; border-radius: 16px; font-weight: 600; cursor: pointer; border: none; width: 100%; transition: 0.2s; background: var(--primary-grad); color: white; display:block; text-align:center; box-shadow: 0 5px 15px rgba(108, 99, 255, 0.3); }
        .btn:active { transform: scale(0.97); }
        .btn-outline { background: transparent; border: 2px solid #E0E0E0; color: #636E72; box-shadow: none; }

        /* AUTH SCREEN */
        #auth-screen { position: fixed; inset: 0; background: var(--white); z-index: 5000; padding: 40px 30px; display: flex; flex-direction: column; justify-content: center; text-align: center; }
        .input-box { width: 100%; background: #F8F9FE; border: 2px solid transparent; color: #2D3436; padding: 16px; border-radius: 14px; margin-bottom: 15px; outline: none; font-size: 1rem; transition: 0.3s; font-weight: 500; }
        .input-box:focus { background: #fff; border-color: var(--primary); box-shadow: 0 0 0 4px rgba(108, 99, 255, 0.1); }
        
        /* APP HEADER */
        header { position: sticky; top: 0; background: rgba(244, 246, 249, 0.85); backdrop-filter: blur(15px); z-index: 900; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(0,0,0,0.05); }
        #app-logo-header { width:40px; height:40px; border-radius:12px; margin-right:12px; object-fit: cover; box-shadow: 0 4px 10px rgba(0,0,0,0.1); display: none; }
        
        /* CHIPS */
        .promo-scroll { display: flex; gap: 15px; overflow-x: auto; padding: 15px 20px; scrollbar-width: none; }
        .promo-card { min-width: 85vw; height: 180px; border-radius: 20px; background-size: cover; background-position: center; border: 1px solid white; box-shadow: var(--card-shadow); }
        .chip { background: white; padding: 10px 20px; border-radius: 25px; margin-right: 10px; display: inline-block; cursor:pointer; font-size: 0.9rem; font-weight: 600; color: #636E72; border: 1px solid #EFEFEF; box-shadow: 0 2px 10px rgba(0,0,0,0.03); }
        .chip.active { background: var(--primary-grad); color: white; border-color: transparent; box-shadow: 0 5px 15px rgba(108, 99, 255, 0.3); }
        .chip-con { overflow-x: auto; white-space: nowrap; padding: 5px 20px 20px; }

        /* CARDS */
        .card { background: white; border-radius: 24px; padding: 0; margin-bottom: 20px; border: 1px solid #fff; box-shadow: var(--card-shadow); overflow: hidden; transition: transform 0.2s; }
        .card:active { transform: scale(0.98); }
        .card-body { padding: 15px 20px; }
        .course-img { width: 100%; height: 180px; object-fit: cover; background: #EEE; }
        
        /* NAV BAR */
        .nav-bar { position: fixed; bottom: 20px; left: 20px; right: 20px; height: 65px; background: rgba(255,255,255,0.9); backdrop-filter: blur(15px); display: none; justify-content: space-around; align-items: center; border-radius: 25px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); z-index: 1000; padding-bottom: 0; }
        .nav-icon { color: #B2BEC3; font-size: 1.2rem; display: flex; flex-direction: column; align-items: center; gap: 0px; cursor:pointer; }
        .nav-icon.active { color: var(--primary); }
        .nav-icon i { font-size: 1.4rem; margin-bottom: 4px; }
        .nav-text { font-size: 0.7rem; font-weight: 600; }

        /* SCREENS & MODALS */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.3); backdrop-filter: blur(5px); z-index: 2000; display: none; align-items: flex-end; justify-content: center; }
        .modal-sheet { background: white; width: 100%; border-radius: 30px 30px 0 0; padding: 30px; max-height: 90vh; overflow-y: auto; box-shadow: 0 -10px 40px rgba(0,0,0,0.1); animation: slideUp 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        .screen { display: none; padding-bottom: 20px; animation: fade 0.3s; }
        @keyframes fade { from{opacity:0}to{opacity:1} }

        #toast-box { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: #2D3436; color: white; padding: 12px 24px; border-radius: 50px; opacity: 0; pointer-events: none; transition: 0.3s; z-index: 5000; box-shadow: 0 10px 20px rgba(0,0,0,0.2); font-weight: 600; }
        
        .notif-item { padding: 15px; border-bottom: 1px solid #f0f0f0; display: flex; gap: 15px; align-items: flex-start; }
        .notif-icon { width: 40px; height: 40px; border-radius: 12px; background: rgba(108, 99, 255, 0.1); color: var(--primary); display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }
    </style>
</head>
<body>

    <!-- AUTH SCREEN -->
    <div id="auth-screen">
        <img id="auth-logo" style="width:80px; border-radius:20px; margin: 0 auto 25px; display:none; box-shadow: 0 10px 30px rgba(108, 99, 255, 0.2);">
        <h1 id="auth-title" style="font-size: 2rem; color: #2D3436; margin-bottom: 5px;">Learning App</h1>
        <p style="color: #888; margin-bottom: 30px; font-weight: 500;">Login to continue your journey</p>
        
        <input class="input-box" type="text" id="a-name" placeholder="Full Name" style="display: none;">
        <input class="input-box" type="email" id="a-email" placeholder="Email Address">
        <input class="input-box" type="password" id="a-pass" placeholder="Password">
        
        <button class="btn" onclick="submitAuth()" id="btn-auth">Sign In</button>
        <div class="toggle-txt" onclick="toggleMode()" style="margin-top: 20px; font-size: 0.9rem; color: #888;">
            <span id="txt-mode" style="color:var(--primary); font-weight:700;">Create new account</span>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="main-app" style="display:none;">
        <header>
            <div style="display:flex; align-items:center;">
                <img id="header-logo" src="" style="display:none;">
                <div>
                    <h3 id="app-title-head" style="font-size:1.1rem; line-height:1.2;">MyApp</h3>
                    <small id="u-name" style="color:#aaa; font-weight:500;">Student</small>
                </div>
            </div>
            <div style="position:relative; width: 40px; height: 40px; background: white; border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.05);" onclick="openNotif()">
                <i class="fas fa-bell" style="font-size:1.2rem; color: #2D3436;"></i>
                <div id="n-badge" style="width:10px;height:10px;background:#FF6B6B;border:2px solid white;border-radius:50%;position:absolute;top:8px;right:8px;display:none"></div>
            </div>
        </header>

        <!-- HOME -->
        <div id="tab-home" class="screen" style="display:block;">
            <div class="promo-scroll" id="home-promo"></div>
            <h3 style="margin:20px 20px 15px; color:#2D3436;">Topics</h3>
            <div class="chip-con" id="cat-chips"></div>
            <h3 style="margin:5px 20px 15px; color:#2D3436;">Popular Courses</h3>
            <div id="home-courses" style="padding: 0 20px;"></div>
        </div>

        <!-- SEARCH -->
        <div id="tab-courses" class="screen">
            <div style="padding: 20px;">
                <input class="input-box" id="search" placeholder="Search for courses..." onkeyup="renderC()" style="background:white; border:none; box-shadow: var(--card-shadow);">
            </div>
            <div id="all-courses" style="padding: 0 20px;"></div>
        </div>

        <!-- LIVE -->
        <div id="tab-live" class="screen" style="padding: 20px;">
            <div id="live-con"></div>
        </div>

        <!-- NOTIF -->
        <div id="tab-notif" class="screen">
            <h2 style="padding: 20px 20px 0;">Notifications</h2>
            <div id="list-notif" style="margin-top: 10px;"></div>
        </div>

        <!-- PROFILE -->
        <div id="tab-profile" class="screen" style="padding: 20px;">
            <div style="background: white; border-radius: 24px; padding: 25px; text-align: center; box-shadow: var(--card-shadow);">
                <div style="width: 80px; height: 80px; background: var(--primary-grad); border-radius: 25px; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem;"><i class="fas fa-user"></i></div>
                <h2 id="prof-name">User Name</h2>
                <p id="prof-email" style="color:#aaa;">user@email.com</p>
                <button class="btn-outline" style="border-radius: 12px; padding: 8px 20px; margin-top: 15px; font-size: 0.85rem;" onclick="openEditProfile()">Edit Profile</button>
            </div>
            
            <h3 style="margin: 25px 0 15px;">My Learning</h3>
            <div id="my-list"></div>

            <div style="margin-top: 30px; margin-bottom: 50px;">
                <div class="card" style="margin-bottom: 10px;" onclick="openSupport()">
                    <div class="card-body" style="display:flex; justify-content:space-between; align-items:center;">
                        <span style="font-weight:600;"><i class="fas fa-headset" style="margin-right:10px; color: var(--primary);"></i> Support</span> <i class="fas fa-chevron-right" style="color:#ddd"></i>
                    </div>
                </div>
                <div class="card" onclick="document.getElementById('modal-policy').style.display='flex'">
                    <div class="card-body" style="display:flex; justify-content:space-between; align-items:center;">
                        <span style="font-weight:600;"><i class="fas fa-shield-alt" style="margin-right:10px; color: var(--primary);"></i> Privacy</span> <i class="fas fa-chevron-right" style="color:#ddd"></i>
                    </div>
                </div>
                <button class="btn" style="background:#FF6B6B; box-shadow: 0 10px 20px rgba(255, 107, 107, 0.3); margin-top:20px;" onclick="logout()">Logout</button>
            </div>
        </div>
    </div>

    <!-- BOTTOM NAV -->
    <div class="nav-bar" id="bottom-nav">
        <div class="nav-icon active" onclick="nav('home')"><i class="fas fa-home"></i> <span class="nav-text">Home</span></div>
        <div class="nav-icon" onclick="nav('courses')"><i class="fas fa-compass"></i> <span class="nav-text">Explore</span></div>
        <div class="nav-icon" onclick="nav('live')"><i class="fas fa-play-circle"></i> <span class="nav-text">Live</span></div>
        <div class="nav-icon" onclick="nav('profile')"><i class="fas fa-user"></i> <span class="nav-text">Profile</span></div>
    </div>

    <!-- MODAL DETAILS -->
    <div id="modal-course" class="modal">
        <div class="modal-sheet">
            <div style="text-align: center; margin-bottom: 20px;"><div style="width: 40px; height: 5px; background: #eee; border-radius: 10px; display: inline-block;"></div></div>
            <div id="c-det-cont"></div>
        </div>
    </div>

    <!-- MODAL PAY -->
    <div id="modal-pay" class="modal" style="z-index: 3500;">
        <div class="modal-sheet" style="text-align: center;">
            <div style="text-align: center; margin-bottom: 20px;"><div style="width: 40px; height: 5px; background: #eee; border-radius: 10px; display: inline-block;"></div></div>
            <h2 style="color:#2D3436; margin-bottom: 5px;">Secure Payment</h2>
            <p style="color:#888; margin-bottom: 20px;">Scan the QR code to proceed</p>
            <div style="background: white; padding: 20px; border-radius: 20px; box-shadow: 0 5px 25px rgba(0,0,0,0.05); display: inline-block;">
                <img id="qr-img" style="width:180px; height: 180px; object-fit: contain;">
            </div>
            <p id="upi-txt" style="font-weight:700; color:var(--primary); margin: 20px 0; background: rgba(108,99,255,0.1); padding: 10px; border-radius: 10px;"></p>
            
            <div class="card" style="border: 2px dashed #ccc; background: #FAFAFA;" onclick="document.getElementById('file-in').click()">
                <div class="card-body">
                    <i class="fas fa-cloud-upload-alt" style="font-size: 1.5rem; color: #888;"></i>
                    <p style="color:#888; margin-top: 5px; font-size: 0.9rem;">Tap to upload screenshot</p>
                </div>
            </div>
            <input type="file" id="file-in" hidden onchange="showPre()">
            <img id="prev-img" style="width:100%; border-radius:15px; margin-top:10px; display:none;">
            
            <button class="btn" style="margin-top: 15px;" onclick="sendPay()">Submit Verification</button>
            <button class="btn-outline" style="width: 100%; margin-top: 10px; padding: 12px; border-radius: 14px;" onclick="closeModal('modal-pay')">Cancel</button>
        </div>
    </div>

    <!-- MODAL EDIT PROFILE -->
    <div id="modal-edit" class="modal">
        <div class="modal-sheet">
            <h3>Update Profile</h3><br>
            <input class="input-box" id="ed-name" placeholder="Enter full name">
            <button class="btn" onclick="saveProfile()">Update</button>
            <button class="btn-outline" style="width: 100%; margin-top: 10px; padding: 12px; border-radius: 14px;" onclick="closeModal('modal-edit')">Cancel</button>
        </div>
    </div>

    <!-- POLICY -->
    <div id="modal-policy" class="modal">
        <div class="modal-sheet">
            <h3>Privacy Policy</h3>
            <p id="policy-content" style="color:#636E72; line-height:1.6; margin-top:15px; white-space: pre-wrap;">Loading...</p>
            <button class="btn" style="margin-top: 20px;" onclick="closeModal('modal-policy')">Close</button>
        </div>
    </div>

    <!-- CONFETTI -->
    <div id="confetti-modal" style="display:none; position:fixed; inset:0; background:rgba(255,255,255,0.9); z-index:9000; align-items:center; justify-content:center; text-align:center;">
        <div class="pop-card" style="box-shadow: 0 20px 60px rgba(108, 99, 255, 0.2);">
            <div id="particles"></div>
            <h1 style="font-size:3rem; margin-bottom:10px;">üéâ</h1>
            <h2 style="color:#2D3436; margin-bottom:10px;">Purchased!</h2>
            <p style="color:#888;">Course unlocked successfully.</p>
            <button class="btn" style="margin-top: 20px;" onclick="document.getElementById('confetti-modal').style.display='none'">Start Learning</button>
        </div>
    </div>

    <div id="toast-box">Alert Message</div>

    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = { apiKey: "FAKE_API_KEY", authDomain: "fake-project.firebaseapp.com", databaseURL: "https://fake-project-default-rtdb.firebaseio.com", projectId: "fake-project", storageBucket: "fake-project.firebasestorage.app", messagingSenderId: "000000000000", appId: "1:000000000000:web:0000000000000000000000" };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        let user=null, myCourses={}, allCourses=[], curPay={}, appSets={};
        
        db.ref('appSettings').on('value', s => {
            appSets = s.val() || {};
            const name = appSets.appName || 'Learning App';
            document.getElementById('auth-title').innerText = name;
            if(appSets.appLogo) {
                const img = document.getElementById('auth-logo');
                img.src = appSets.appLogo; img.style.display = 'block';
                const himg = document.getElementById('header-logo');
                himg.src = appSets.appLogo; himg.style.display = 'block';
            }
            document.getElementById('app-title-head').innerText = name;
            document.getElementById('policy-content').innerText = appSets.policyText || "No policy defined yet.";
        });

        let isReg = false;
        function toggleMode(){ isReg=!isReg; document.getElementById('a-name').style.display=isReg?'block':'none'; document.getElementById('btn-auth').innerText=isReg?'Create Account':'Sign In'; document.getElementById('txt-mode').innerText=isReg?'Already have account? Sign In':'Create new account'; }
        
        auth.onAuthStateChanged(u => {
            if(u){
                user=u;
                document.getElementById('auth-screen').style.display='none';
                document.getElementById('main-app').style.display='block';
                document.getElementById('bottom-nav').style.display='flex';
                document.getElementById('prof-email').innerText = u.email;
                
                db.ref('users/'+u.uid).once('value', s=>{
                    if(s.exists() && s.val().name) {
                        const n = s.val().name;
                        document.getElementById('u-name').innerText = n.split(' ')[0];
                        document.getElementById('prof-name').innerText = n;
                    } else {
                        document.getElementById('prof-name').innerText = "Student";
                    }
                });
                
                loadData();
            } else {
                document.getElementById('auth-screen').style.display='flex';
                document.getElementById('main-app').style.display='none';
                document.getElementById('bottom-nav').style.display='none';
            }
        });

        function submitAuth(){
            const e=document.getElementById('a-email').value, p=document.getElementById('a-pass').value;
            if(isReg) {
                const n = document.getElementById('a-name').value;
                auth.createUserWithEmailAndPassword(e,p).then(c=>{
                    db.ref('users/'+c.user.uid).update({name:n, email:e});
                }).catch(err=>toast(err.message));
            } else {
                auth.signInWithEmailAndPassword(e,p).catch(err=>toast(err.message));
            }
        }
        function logout(){ auth.signOut(); }

        function loadData(){
            db.ref('courses').on('value',s=>{ allCourses=[]; s.forEach(c=>allCourses.push({id:c.key,...c.val()})); renderC(); });
            db.ref('users/'+user.uid+'/courses').on('value',s=>{
                const nC = s.numChildren(), oC = localStorage.getItem('cc')||0;
                myCourses=s.val()||{};
                if(nC>oC && oC!=0) showConfetti();
                localStorage.setItem('cc', nC);
                renderC();
            });
            db.ref('categories').on('value',s=>{ const d=document.getElementById('cat-chips'); d.innerHTML='<div class="chip active" onclick="filt(this,\'ALL\')">All Topics</div>'; s.forEach(c=>d.innerHTML+=`<div class="chip" onclick="filt(this,'${c.val().name}')">${c.val().name}</div>`); });
            db.ref('promotions').on('value',s=>{ const d=document.getElementById('home-promo'); d.innerHTML=''; s.forEach(p=>{ const v=p.val(); d.innerHTML+=`<div class="promo-card" style="background-image:url('${v.img}')" ${v.link?`onclick="window.open('${v.link}','_blank')"`:''}></div>`; }); startSlide(); });
            db.ref('liveSession').on('value',s=>{
                const v=s.val();
                if(v&&v.status==='ON') document.getElementById('live-con').innerHTML=`<div class="card" style="border:1px solid #FF6B6B;"><div class="card-body" style="text-align:center;"><div style="color:red; font-weight:700; margin-bottom:5px;">‚óè LIVE NOW</div><h2 style="font-size:1.3rem;">${v.description}</h2><p style="color:#888;">${v.price?'$'+v.price:'FREE'}</p><button class="btn" style="background:#FF6B6B; margin-top:10px;" onclick="window.open('${v.link}','_blank')">Join Stream</button></div></div>`;
                else document.getElementById('live-con').innerHTML='<div class="card"><div class="card-body" style="text-align:center;color:#aaa;"><i class="fas fa-video-slash" style="font-size:2rem;margin-bottom:10px;"></i><p>No active live session</p></div></div>';
            });
            db.ref('notifications').limitToLast(15).on('value',s=>{ 
                const d=document.getElementById('list-notif'); d.innerHTML=''; let cnt=0; const a=[]; 
                s.forEach(x=>a.unshift(x.val())); 
                a.forEach(n=>{ 
                    if(n.targetType==='ALL'||(n.targetType==='SINGLE'&&n.targetEmail===user.email)){ 
                        cnt++; 
                        d.innerHTML+=`<div class="notif-item">
                            <div class="notif-icon"><i class="fas fa-bell"></i></div>
                            <div style="flex:1;">
                                <div style="font-weight:600; color:#2D3436; font-size:0.95rem;">${n.message}</div>
                                ${n.link?`<div style="font-size:0.8rem; color:var(--primary); font-weight:600; margin-top:5px; cursor:pointer;" onclick="window.open('${n.link}')">Tap to View <i class="fas fa-arrow-right" style="font-size:0.7rem;"></i></div>`:''}
                            </div>
                        </div>`; 
                    } 
                }); 
                if(cnt>0) document.getElementById('n-badge').style.display='block'; 
            });
        }

        function openEditProfile(){ 
            document.getElementById('ed-name').value = document.getElementById('prof-name').innerText;
            document.getElementById('modal-edit').style.display='flex'; 
        }
        function saveProfile(){
            const n = document.getElementById('ed-name').value;
            if(n) db.ref('users/'+user.uid).update({name:n}).then(()=>{ toast('Profile Updated'); closeModal('modal-edit'); });
        }

        let cf='ALL';
        function filt(e,c){ cf=c; document.querySelectorAll('.chip').forEach(x=>x.classList.remove('active')); e.classList.add('active'); renderC(); }
        
        function renderC(){
            const l=document.getElementById('home-courses'), s=document.getElementById('all-courses'), m=document.getElementById('my-list'), q=document.getElementById('search').value.toLowerCase();
            l.innerHTML=''; s.innerHTML=''; m.innerHTML='';
            allCourses.forEach(c=>{
                const o=myCourses[c.id];
                // Fallback Logic
                const catText = c.categoryName || 'General';
                const imgSrc = (c.bannerUrl && c.bannerUrl.length>5) ? c.bannerUrl : 'https://via.placeholder.com/300x180/EEE/AAA?text=Course';
                
                const cd=`
                <div class="card" onclick="openC('${c.id}')">
                    <img src="${imgSrc}" class="course-img" onerror="this.src='https://via.placeholder.com/300x180/EEE/AAA?text=No+Image'">
                    <div class="card-body">
                        <span style="font-size:0.75rem; color:var(--primary); font-weight:700; text-transform:uppercase;">${catText}</span>
                        <h3 style="font-size:1.1rem; margin:5px 0 10px; color:#2D3436;">${c.title}</h3>
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <span style="color:#B2BEC3; font-size:0.85rem;"><i class="fas fa-video"></i> Course</span>
                            <span style="font-weight:700; color:${o?'#00B894':'#2D3436'}; background:${o?'rgba(0,184,148,0.1)':'#F5F6FA'}; padding:4px 10px; border-radius:8px; font-size:0.85rem;">${o?'Owned':'$'+c.price}</span>
                        </div>
                    </div>
                </div>`;
                if((cf==='ALL'||catText===cf)) l.innerHTML+=cd;
                if(c.title.toLowerCase().includes(q)) s.innerHTML+=cd;
                if(o) m.innerHTML+=cd;
            });
            if(m.innerHTML==='') m.innerHTML=`<div style="text-align:center; padding:30px; color:#aaa;"><i class="fas fa-box-open" style="font-size:2rem; margin-bottom:10px;"></i><p>No courses owned yet</p></div>`;
        }

        function openC(id){
            const c=allCourses.find(x=>x.id===id), o=myCourses[id], d=document.getElementById('c-det-cont');
            let v=c.videoUrl; if(v && v.includes('youtu.be/')) v=v.split('youtu.be/')[1].split('?')[0]; else if(v && v.includes('v=')) v=v.split('v=')[1].split('&')[0];
            const imgSrc = (c.bannerUrl && c.bannerUrl.length>5) ? c.bannerUrl : 'https://via.placeholder.com/300x180/EEE/AAA?text=Course';

            d.innerHTML=`
            ${o 
                ? `<iframe style="width:100%; height:200px; border-radius:15px; border:none; box-shadow:0 10px 30px rgba(0,0,0,0.1);" src="https://www.youtube.com/embed/${v}?modestbranding=1" allowfullscreen></iframe>
                   ${c.notesUrl ? `<button class="btn-outline" style="margin-top:15px; padding:12px; width:100%; border-radius:12px;" onclick="window.open('${c.notesUrl}','_blank')"><i class="fas fa-file-pdf"></i> Download Resources</button>` : ''}`
                : `<img src="${imgSrc}" style="width:100%; border-radius:15px; filter:brightness(0.9);">
                   <h2 style="position:absolute; top:35%; left:50%; transform:translate(-50%,-50%); color:white; text-shadow:0 2px 10px rgba(0,0,0,0.5);"><i class="fas fa-lock"></i> Locked</h2>
                   <div style="margin-top:-20px; position:relative; text-align:center;">
                        <button class="btn" onclick="pay('${c.id}','${c.price}','${c.title}')">Buy Access for $${c.price}</button>
                   </div>`
            }
            <h2 style="margin-top:20px; color:#2D3436;">${c.title}</h2>
            <p style="color:#636E72; line-height:1.6; margin-top:10px;">${c.description}</p>
            `;
            document.getElementById('modal-course').style.display='flex';
        }

        function pay(id,p,t){ db.ref('adminSettings').once('value',s=>{ curPay={id,p,t}; const v=s.val()||{}; document.getElementById('qr-img').src=v.qr||''; document.getElementById('upi-txt').innerText=v.upi||''; document.getElementById('modal-pay').style.display='flex'; }); }
        function showPre(){ const f=document.getElementById('file-in').files[0], r=new FileReader(); r.onload=e=>{document.getElementById('prev-img').src=e.target.result;document.getElementById('prev-img').style.display='block';}; r.readAsDataURL(f); }
        function sendPay(){ const s=document.getElementById('prev-img').src; if(!s)return toast('Upload proof first'); db.ref('payments').push({userId:user.uid,userEmail:user.email,courseId:curPay.id,courseTitle:curPay.t,amount:curPay.p,screenshot:s,status:'PENDING',timestamp:Date.now()}).then(()=>{closeModal('modal-pay');toast('Sent for review');}); }

        function startSlide(){ setInterval(()=>{ const d=document.getElementById('home-promo'); d.scrollLeft+=300; if(d.scrollLeft>=d.scrollWidth-d.clientWidth)d.scrollLeft=0; },3000); }
        function nav(s){ document.querySelectorAll('.screen').forEach(x=>x.style.display='none'); document.getElementById('tab-'+s).style.display='block'; document.querySelectorAll('.nav-icon').forEach(x=>x.classList.remove('active')); event.currentTarget.classList.add('active'); window.scrollTo(0,0); }
        function openNotif(){ nav('notif'); document.getElementById('n-badge').style.display='none'; }
        function closeModal(i){ document.getElementById(i).style.display='none'; }
        function openSupport(){ if(appSets.supportLink) window.open(appSets.supportLink, '_blank'); else toast('Support not linked'); }
        function toast(m){ const t=document.getElementById('toast-box'); t.innerText=m; t.style.opacity=1; t.style.bottom="120px"; setTimeout(()=>{t.style.opacity=0;t.style.bottom="100px"},3000); }
        function showConfetti(){ 
            const m=document.getElementById('confetti-modal'), p=document.getElementById('particles'), cols=['#6C63FF','#8A2BE2','#FF6B6B','#FFD166']; 
            p.innerHTML=''; for(let i=0;i<40;i++){const e=document.createElement('div');e.className='particle';e.style.left=Math.random()*100+'vw';e.style.animationDuration=(Math.random()*2+1)+'s';e.style.backgroundColor=cols[Math.floor(Math.random()*cols.length)];p.appendChild(e);} m.style.display='flex';
        }
    </script>
</body>
</html>

### 2Ô∏è‚É£ **Admin Panel (`admin.html`)**

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Admin Master</title>
    <!-- FontAwesome & Google Fonts -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #6C63FF;
            --primary-grad: linear-gradient(135deg, #8A2BE2 0%, #4B0082 100%);
            --secondary-grad: linear-gradient(135deg, #FF6B6B 0%, #EE5D5D 100%);
            --bg: #F4F7FC;
            --card-bg: #FFFFFF;
            --sidebar-bg: #1A1A2E;
            --text-main: #2D3436;
            --text-sec: #636E72;
            --border: #EFEFEF;
            --shadow: 0 10px 30px rgba(0,0,0,0.05);
            --shadow-hover: 0 15px 35px rgba(138, 43, 226, 0.15);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; outline: none; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text-main); overflow-x: hidden; font-size: 14px; }

        /* BUTTONS */
        .btn { padding: 12px 20px; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); display: inline-block; width: 100%; text-align: center; letter-spacing: 0.5px; font-size: 0.9rem; position: relative; overflow: hidden; }
        
        .btn-primary { background: var(--primary-grad); color: white; box-shadow: 0 4px 15px rgba(138, 43, 226, 0.3); }
        .btn-primary:active { transform: scale(0.97); }
        
        .btn-danger { background: var(--secondary-grad); color: white; width: auto; padding: 8px 16px; border-radius: 8px; font-size: 0.8rem; box-shadow: 0 4px 10px rgba(238, 93, 93, 0.3); }
        
        .btn-outline { background: transparent; border: 2px solid #E0E0E0; color: var(--text-sec); font-weight: 600; }
        .btn-outline:hover { border-color: var(--primary); color: var(--primary); background: rgba(108, 99, 255, 0.05); }

        /* INPUTS */
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; color: var(--text-sec); font-size: 0.85rem; margin-bottom: 8px; font-weight: 500; }
        input, select, textarea { width: 100%; padding: 14px 16px; background: #FAFBFF; border: 2px solid #EFF0F6; color: var(--text-main); border-radius: 12px; font-size: 0.95rem; transition: 0.3s; }
        input:focus, select:focus, textarea:focus { border-color: var(--primary); background: #fff; box-shadow: 0 0 0 4px rgba(108, 99, 255, 0.1); }

        /* CARDS */
        .card { background: var(--card-bg); padding: 20px; border-radius: 20px; margin-bottom: 20px; box-shadow: var(--shadow); border: 1px solid white; transition: 0.3s; position: relative; overflow: hidden; }
        .flex-row { display: flex; justify-content: space-between; align-items: center; }

        /* LOADING */
        #loader { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .spinner { border: 4px solid rgba(138, 43, 226, 0.1); border-top: 4px solid #8A2BE2; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* AUTH SCREEN */
        #auth-screen { position: fixed; inset: 0; background: #fff; z-index: 2000; display: flex; flex-direction: column; justify-content: center; padding: 40px; }
        .auth-card { max-width: 400px; width: 100%; margin: 0 auto; text-align: center; }
        .auth-logo { width: 80px; height: 80px; border-radius: 20px; background: var(--primary-grad); margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; color: white; font-size: 30px; box-shadow: 0 10px 20px rgba(138, 43, 226, 0.3); }

        /* APP STRUCTURE */
        #app-container { display: none; padding-top: 70px; min-height: 100vh; padding-bottom: 40px; }
        
        /* HEADER */
        header { position: fixed; top: 0; left: 0; width: 100%; height: 70px; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); z-index: 1000; display: flex; align-items: center; padding: 0 20px; justify-content: space-between; border-bottom: 1px solid rgba(0,0,0,0.05); box-shadow: 0 5px 20px rgba(0,0,0,0.02); }
        .menu-btn { font-size: 1.4rem; color: var(--text-main); cursor: pointer; background: #F5F6FA; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 10px; }
        .header-title { font-weight: 700; font-size: 1.2rem; color: var(--text-main); }

        /* SIDE MENU */
        #side-menu { position: fixed; top: 0; left: 0; width: 280px; height: 100%; background: var(--sidebar-bg); z-index: 1500; transform: translateX(-100%); transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); display: flex; flex-direction: column; box-shadow: 5px 0 20px rgba(0,0,0,0.1); border-radius: 0 25px 25px 0; overflow: hidden; }
        #side-menu.active { transform: translateX(0); }
        
        .menu-header { padding: 40px 25px 20px; background: linear-gradient(135deg, #8A2BE2 0%, #6C63FF 100%); color: white; font-size: 1.5rem; font-weight: 800; display: flex; flex-direction: column; justify-content: flex-end; height: 160px; }
        .menu-content { overflow-y: auto; padding: 15px; flex: 1; }
        .menu-item { padding: 14px 18px; margin-bottom: 8px; border-radius: 12px; cursor: pointer; color: rgba(255,255,255,0.7); display: flex; align-items: center; gap: 15px; transition: 0.2s; font-weight: 500; font-size: 0.95rem; }
        .menu-item:hover { background: rgba(255,255,255,0.05); color: white; }
        .menu-item.active-link { background: #6C63FF; color: white; box-shadow: 0 5px 15px rgba(108, 99, 255, 0.4); }
        
        .menu-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.2); backdrop-filter: blur(3px); z-index: 1400; opacity: 0; pointer-events: none; transition: 0.3s; }
        .menu-overlay.active { opacity: 1; pointer-events: auto; }

        /* SECTIONS */
        .section { display: none; padding: 20px; animation: slideUp 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); }
        .section.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* DASHBOARD STATS */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .stat-card { background: white; padding: 20px; border-radius: 18px; text-align: center; border: 1px solid #f0f0f0; box-shadow: var(--shadow); position: relative; overflow: hidden; }
        .stat-card::before { content:''; position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: var(--primary-grad); }
        .stat-val { font-size: 1.8rem; font-weight: 800; color: #2D3436; margin-top: 8px; }
        .stat-label { font-size: 0.85rem; color: #888; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }

        /* MODALS */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); z-index: 3000; display: none; align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: white; width: 100%; max-width: 500px; border-radius: 24px; padding: 30px; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 50px rgba(0,0,0,0.2); transform: translateY(20px); animation: modalIn 0.3s forwards; }
        @keyframes modalIn { to { transform: translateY(0); } }
        
        .list-item-img { width: 50px; height: 50px; border-radius: 12px; object-fit: cover; margin-right: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .badge { font-size: 0.7rem; background: rgba(108, 99, 255, 0.1); color: var(--primary); padding: 4px 10px; border-radius: 6px; font-weight: 700; margin-top: 5px; display: inline-block; }

        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #2D3436; color: white; padding: 12px 24px; border-radius: 50px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); z-index: 5000; display: none; font-weight: 500; font-size: 0.9rem; align-items: center; gap: 10px; }

    </style>
</head>
<body>

    <div id="loader"><div class="spinner"></div></div>
    <div id="toast" class="toast"></div>

    <!-- AUTH -->
    <div id="auth-screen">
        <div class="auth-card">
            <div class="auth-logo"><i class="fas fa-cube"></i></div>
            <h2 style="font-weight: 800; color: #2D3436; margin-bottom: 5px; font-size: 1.8rem;">Admin Portal</h2>
            <p style="color: #888; margin-bottom: 30px;">Manage your content efficiently</p>
            <div class="input-group" style="text-align: left;">
                <label>Email Address</label>
                <input id="l-email" type="email" placeholder="admin@master.com">
            </div>
            <div class="input-group" style="text-align: left;">
                <label>Password</label>
                <input id="l-pass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            <button class="btn btn-primary" onclick="handleLogin()">Sign In Dashboard</button>
        </div>
    </div>

    <!-- APP CONTAINER -->
    <div id="app-container">
        
        <header>
            <div class="menu-btn" onclick="toggleMenu()"><i class="fas fa-bars"></i></div>
            <img id="header-logo-admin" style="width:30px; height:30px; border-radius:8px; display:none; object-fit:cover; margin-right:10px;">
            <div style="flex:1;"><span class="header-title" id="page-title">Dashboard</span></div>
        </header>

        <div class="menu-overlay" onclick="toggleMenu()"></div>
        <div id="side-menu">
            <div class="menu-header">
                <i class="fas fa-layer-group" style="margin-bottom:10px; font-size: 2rem; opacity: 0.8;"></i>
                <span id="admin-brand-name">App Master</span>
            </div>
            <div class="menu-content">
                <div class="menu-item active-link" onclick="nav('dashboard')"><i class="fas fa-home"></i> Dashboard</div>
                <div class="menu-item" onclick="nav('app-controls')"><i class="fas fa-mobile-alt"></i> App Control</div>
                <div class="menu-item" onclick="nav('courses')"><i class="fas fa-book"></i> Courses</div>
                <div class="menu-item" onclick="nav('categories')"><i class="fas fa-tags"></i> Categories</div>
                <div class="menu-item" onclick="nav('slider')"><i class="fas fa-images"></i> Banners</div>
                <div class="menu-item" onclick="nav('live')"><i class="fas fa-video"></i> Live Stream</div>
                <div class="menu-item" onclick="nav('payments')"><i class="fas fa-wallet"></i> Payments</div>
                <div class="menu-item" onclick="nav('notifications')"><i class="fas fa-bell"></i> Push Notify</div>
                <div class="menu-item" onclick="nav('settings')"><i class="fas fa-credit-card"></i> Pay Settings</div>
                <div style="height: 20px;"></div>
                <div class="menu-item" onclick="logout()" style="color:#ff6b6b"><i class="fas fa-sign-out-alt"></i> Logout</div>
            </div>
        </div>

        <!-- 1. DASHBOARD -->
        <div id="sec-dashboard" class="section active">
            <h2 style="margin-bottom:20px; color:#2d3436;">Overview</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total Users</div>
                    <div class="stat-val" id="st-users">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Active Courses</div>
                    <div class="stat-val" id="st-courses">0</div>
                </div>
                <div class="stat-card" style="grid-column:span 2; background: linear-gradient(135deg, #6C63FF, #8A2BE2); color:white; border:none;">
                    <div class="stat-label" style="color:rgba(255,255,255,0.7);">Total Revenue</div>
                    <div class="stat-val" style="color:white;" id="st-rev">$0</div>
                </div>
            </div>
        </div>

        <!-- APP CONTROLS -->
        <div id="sec-app-controls" class="section">
            <div class="card">
                <h3><i class="fas fa-palette"></i> Branding</h3><br>
                <div class="input-group"><label>App Name</label><input id="app-name"></div>
                <div class="input-group"><label>Logo URL</label><input id="app-logo"></div>
                <div class="input-group"><label>Support Link</label><input id="app-support"></div>
                <div class="input-group"><label>Privacy Policy</label><textarea id="app-policy" rows="5"></textarea></div>
                <button class="btn btn-primary" onclick="saveAppSets()">Save Configuration</button>
            </div>
        </div>

        <!-- NOTIFICATIONS -->
        <div id="sec-notifications" class="section">
            <div class="card">
                <h3><i class="fas fa-paper-plane"></i> Send Alert</h3><br>
                <div class="input-group">
                    <label>Target Audience</label>
                    <select id="n-to" onchange="toggleNEmail()"><option value="ALL">All Users</option><option value="SINGLE">Single User</option></select>
                </div>
                <div class="input-group" id="n-email-div" style="display:none">
                    <label>User Email</label><input id="n-email">
                </div>
                <div class="input-group"><label>Message Content</label><textarea id="n-msg" rows="3"></textarea></div>
                <div class="input-group"><label>Action Link (Optional)</label><input id="n-link"></div>
                <button class="btn btn-primary" onclick="sendNotify()">Send Notification</button>
            </div>
        </div>

        <!-- COURSES -->
        <div id="sec-courses" class="section">
            <div class="flex-row" style="margin-bottom:15px;">
                <h3>Courses</h3>
                <button class="btn btn-primary" style="width:auto; padding: 10px 20px;" onclick="openModal('modal-course')"><i class="fas fa-plus"></i> Add</button>
            </div>
            <div id="list-courses"></div>
        </div>

        <!-- CATEGORIES -->
        <div id="sec-categories" class="section">
            <div class="card">
                <h3>New Category</h3>
                <div class="input-group" style="margin-top:10px;">
                    <input id="cat-name" placeholder="Category Name">
                </div>
                <button class="btn btn-primary" onclick="saveCat()">Create Category</button>
            </div>
            <h4 style="margin:20px 0 10px;">Existing Categories</h4>
            <div id="list-cats"></div>
        </div>

        <!-- LIVE -->
        <div id="sec-live" class="section">
            <div class="card">
                <h3><i class="fas fa-broadcast-tower"></i> Live Session Control</h3><br>
                <div class="input-group"><label>Session Title</label><input id="l-desc"></div>
                <div class="input-group"><label>Meeting Link</label><input id="l-link"></div>
                <div class="input-group"><label>Price ($0 for Free)</label><input type="number" id="l-price" value="0"></div>
                <div class="input-group"><label>Session Status</label><select id="l-stat"><option value="OFF">Ended / Offline</option><option value="ON">LIVE NOW</option></select></div>
                <button class="btn btn-primary" onclick="saveLive()">Update Status</button>
            </div>
        </div>

        <!-- SLIDER -->
        <div id="sec-slider" class="section">
            <button class="btn btn-primary" onclick="openModal('modal-promo')">+ Add Banner Slide</button>
            <div id="list-promo" style="margin-top:20px"></div>
        </div>

        <!-- PAYMENTS -->
        <div id="sec-payments" class="section">
            <div id="list-payments"></div>
        </div>

        <!-- SETTINGS -->
        <div id="sec-settings" class="section">
            <div class="card">
                <h3>Payment Methods</h3><br>
                <div class="input-group"><label>UPI ID (e.g. name@bank)</label><input id="set-upi"></div>
                <div class="input-group"><label>QR Code Image URL</label><input id="set-qr"></div>
                <button class="btn btn-primary" onclick="saveSets()">Save Payment Info</button>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div id="modal-course" class="modal">
        <div class="modal-content">
            <h3>Course Details</h3><br>
            <div class="input-group"><label>Title</label><input id="c-title"></div>
            <div class="input-group"><label>Category</label><select id="c-cat"></select></div>
            <div class="input-group"><label>Price ($)</label><input id="c-price" type="number"></div>
            <div class="input-group"><label>Description</label><textarea id="c-desc" rows="2"></textarea></div>
            <div class="input-group"><label>Cover Image URL</label><input id="c-img"></div>
            <div class="input-group"><label>Video Link (YouTube)</label><input id="c-vid"></div>
            <div class="input-group"><label>Notes Link (PDF/Drive)</label><input id="c-note"></div>
            <div class="flex-row" style="gap:10px; margin-top:20px;">
                <button class="btn btn-primary" onclick="saveCourse()">Save Course</button>
                <button class="btn btn-outline" onclick="closeModal('modal-course')">Close</button>
            </div>
        </div>
    </div>

    <div id="modal-promo" class="modal">
        <div class="modal-content">
            <h3>New Banner</h3><br>
            <div class="input-group"><label>Image URL</label><input id="p-img"></div>
            <div class="input-group"><label>Tap Link (Optional)</label><input id="p-link"></div>
            <div class="flex-row" style="gap:10px; margin-top:20px;">
                <button class="btn btn-primary" onclick="savePromo()">Add Banner</button>
                <button class="btn btn-outline" onclick="closeModal('modal-promo')">Close</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = { apiKey: "FAKE_API_KEY", authDomain: "fake-project.firebaseapp.com", databaseURL: "https://fake-project-default-rtdb.firebaseio.com", projectId: "fake-project", storageBucket: "fake-project.firebasestorage.app", messagingSenderId: "000000000000", appId: "1:000000000000:web:0000000000000000000000" };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
        let allCats = {};

        auth.onAuthStateChanged(user => {
            document.getElementById('loader').style.display='none';
            if(user) {
                document.getElementById('auth-screen').style.display='none';
                document.getElementById('app-container').style.display='block';
                init();
            } else {
                document.getElementById('auth-screen').style.display='flex';
                document.getElementById('app-container').style.display='none';
            }
        });

        function handleLogin() {
            document.getElementById('loader').style.display='flex';
            auth.signInWithEmailAndPassword(document.getElementById('l-email').value, document.getElementById('l-pass').value)
                .catch(err => { document.getElementById('loader').style.display='none'; showToast(err.message); });
        }
        function logout(){ auth.signOut(); }

        function toggleMenu(){ 
            document.getElementById('side-menu').classList.toggle('active'); 
            document.querySelector('.menu-overlay').classList.toggle('active');
        }
        function nav(s){ 
            toggleMenu(); 
            document.querySelectorAll('.section').forEach(d=>d.classList.remove('active'));
            document.querySelector(`.menu-item[onclick="nav('${s}')"]`)?.classList.add('active-link');
            document.getElementById('sec-'+s).classList.add('active');
            const map = {'dashboard':'Dashboard', 'app-controls':'App Controls', 'notifications':'Notifications', 'courses':'Manage Courses', 'categories':'Categories', 'live':'Live Session', 'slider':'Banners', 'payments':'Payments', 'settings':'Pay Settings'};
            document.getElementById('page-title').innerText = map[s]||'Admin';
        }
        function openModal(id){ if(id==='modal-course') fillCatSelect(); document.getElementById(id).style.display='flex'; }
        function closeModal(id){ document.getElementById(id).style.display='none'; }
        function showToast(m){ const t = document.getElementById('toast'); t.innerText=m; t.style.display='flex'; setTimeout(()=>t.style.display='none',3000); }

        function init(){
            db.ref('users').on('value', s=>document.getElementById('st-users').innerText=s.numChildren());
            db.ref('courses').on('value', s=>document.getElementById('st-courses').innerText=s.numChildren());
            
            db.ref('payments').on('value', s => {
                let rev = 0; let pendingHTML = ''; const payList = document.getElementById('list-payments');
                s.forEach(doc => {
                    const p = doc.val();
                    if(p.status === 'APPROVED') { rev += parseFloat(p.amount || 0); } 
                    else if (p.status === 'PENDING') {
                        pendingHTML += `<div class="card">
                            <div class="flex-row"><div><b>${p.courseTitle}</b><br><small class="badge">$${p.amount}</small></div><small>${p.userEmail}</small></div>
                            <img src="${p.screenshot}" style="max-height:150px; border-radius:12px; margin:15px 0; border:1px solid #eee;">
                            <div class="flex-row"><button class="btn btn-primary" onclick="processPay('${doc.key}','${p.userId}','${p.courseId}',true)">Approve Access</button><div style="width:10px"></div><button class="btn btn-outline" style="color:red; border-color:red;" onclick="processPay('${doc.key}','${p.userId}','${p.courseId}',false)">Reject</button></div>
                        </div>`;
                    }
                });
                document.getElementById('st-rev').innerText = "$" + rev.toFixed(0);
                payList.innerHTML = pendingHTML || '<div class="card" style="text-align:center; color:#999; border:1px dashed #ddd; box-shadow:none;">No Pending Payments</div>';
            });
            loadData();
        }

        function loadData() {
            db.ref('categories').on('value', s=>{
                const d=document.getElementById('list-cats'); d.innerHTML=''; allCats={};
                s.forEach(c=>{
                    allCats[c.key]=c.val().name;
                    d.innerHTML+=`<div class="card flex-row" style="padding:15px;"><b>${c.val().name}</b><button class="btn-danger" style="width:auto" onclick="db.ref('categories/${c.key}').remove()">Delete</button></div>`;
                });
            });

            db.ref('courses').on('value', s=>{
                const d=document.getElementById('list-courses'); d.innerHTML='';
                s.forEach(c=>{
                    d.innerHTML+=`<div class="card flex-row">
                        <div style="display:flex;align-items:center;">
                            <img src="${c.val().bannerUrl}" class="list-item-img">
                            <div><b>${c.val().title}</b><br><small style="color:#888">$${c.val().price}</small></div>
                        </div>
                        <button class="btn-outline" style="width:auto; padding:5px 15px;" onclick="db.ref('courses/${c.key}').remove()">Delete</button>
                    </div>`;
                });
            });

            db.ref('promotions').on('value', s=>{
                const d=document.getElementById('list-promo'); d.innerHTML='';
                s.forEach(p=>{
                   d.innerHTML+=`<div class="card flex-row"><img src="${p.val().img}" height="60" style="border-radius:10px;"><button class="btn-danger" style="width:auto" onclick="db.ref('promotions/${p.key}').remove()">Remove</button></div>`; 
                });
            });

            db.ref('appSettings').on('value', s => {
                const v = s.val() || {};
                document.getElementById('app-name').value = v.appName || '';
                document.getElementById('app-logo').value = v.appLogo || '';
                document.getElementById('app-support').value = v.supportLink || '';
                document.getElementById('app-policy').value = v.policyText || '';
                if(v.appName) { document.getElementById('admin-brand-name').innerText = v.appName; }
                if(v.appLogo) { 
                    const l = document.getElementById('header-logo-admin'); 
                    l.src=v.appLogo; l.style.display='block';
                }
            });

            db.ref('liveSession').on('value',s=>{ if(s.exists()){ const v=s.val(); document.getElementById('l-desc').value=v.description; document.getElementById('l-link').value=v.link; document.getElementById('l-stat').value=v.status; document.getElementById('l-price').value=v.price||0; }});
            db.ref('adminSettings').on('value', s=>{ if(s.exists()){ document.getElementById('set-upi').value=s.val().upi; document.getElementById('set-qr').value=s.val().qr; }});
        }

        function fillCatSelect(){ const s=document.getElementById('c-cat'); s.innerHTML=''; Object.keys(allCats).forEach(k=>s.innerHTML+=`<option value="${k}">${allCats[k]}</option>`); }
        function saveCat(){ const n=document.getElementById('cat-name').value; if(n) db.ref('categories').push({name:n}).then(()=>{document.getElementById('cat-name').value=''; showToast('Category Added');}); }
        function saveCourse(){
            db.ref('courses').push({
                title: document.getElementById('c-title').value,
                categoryId: document.getElementById('c-cat').value,
                categoryName: allCats[document.getElementById('c-cat').value],
                description: document.getElementById('c-desc').value,
                price: document.getElementById('c-price').value,
                bannerUrl: document.getElementById('c-img').value,
                videoUrl: document.getElementById('c-vid').value,
                notesUrl: document.getElementById('c-note').value
            }).then(()=>{ closeModal('modal-course'); showToast('Course Published'); });
        }
        function savePromo(){ db.ref('promotions').push({ img:document.getElementById('p-img').value, link:document.getElementById('p-link').value }).then(()=>closeModal('modal-promo')); }
        function saveAppSets() {
            db.ref('appSettings').update({ appName:document.getElementById('app-name').value, appLogo:document.getElementById('app-logo').value, supportLink:document.getElementById('app-support').value, policyText:document.getElementById('app-policy').value }).then(() => showToast('Branding Saved'));
        }
        function saveSets(){ db.ref('adminSettings').update({ upi:document.getElementById('set-upi').value, qr:document.getElementById('set-qr').value }).then(()=>showToast('Payments Saved')); }
        function saveLive(){ db.ref('liveSession').update({ description:document.getElementById('l-desc').value, link:document.getElementById('l-link').value, price:document.getElementById('l-price').value, status:document.getElementById('l-stat').value }).then(()=>showToast('Live Updated')); }
        function processPay(pid, uid, cid, ok){
            const up = {}; up['payments/'+pid+'/status'] = ok?'APPROVED':'REJECTED';
            if(ok) up['users/'+uid+'/courses/'+cid] = true;
            db.ref().update(up).then(()=>showToast(ok?'Granted Access':'Payment Rejected'));
        }
        function toggleNEmail(){ document.getElementById('n-email-div').style.display = document.getElementById('n-to').value==='SINGLE' ? 'block':'none'; }
        function sendNotify(){
            const t=document.getElementById('n-to').value;
            db.ref('notifications').push({ targetType:t, targetEmail:document.getElementById('n-email').value, message:document.getElementById('n-msg').value, link:document.getElementById('n-link').value, timestamp:Date.now() }).then(()=>showToast('Sent!'));
        }
    </script>
</body>
</html>